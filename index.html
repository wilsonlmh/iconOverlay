<!doctype html>
<html>

<head>
    <meta charset="UTF-8">
    <title>2015&nbsp;成人宣誓日&nbsp;-&nbsp;頭像&nbsp;Icon&nbsp;大變身</title>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
    <meta name="viewport" content="width=1200 user-scalable=no" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="成人宣誓日">
    <link rel="apple-touch-icon" sizes="152x152" href="img/ios_webapp/icon-01.png">
    <link href="img/ios_webapp/startup_iphone5-01.png" media="(device-width: 320px) and (-webkit-device-pixel-ratio: 2)" rel="apple-touch-startup-image">
    <meta property="og:title" content="2015&nbsp;成人宣誓日&nbsp;-&nbsp;頭像&nbsp;Icon&nbsp;大變身" />
    <meta property="og:type" content="website" />
    <meta property="og:url" content="http://www.panmacjc.org.mo/acd_icon/" />
    <meta property="og:image" content="http://www.panmacjc.org.mo/acd_icon/img/fb_og/icon-01.png" />
    <meta property="og:description" content="在世界各地，為踏入成人階段的青少年兒童舉行成人禮儀式的習俗或社會活動十分普遍。在­澳門，汎澳青年商會在2000年首度倡議成人宣誓日活動，核心內容為參與者面對國旗區­旗宣誓，立志成為愛國愛澳，有理想，守法盡責的良好公民。作為汎澳青年商會每年的重點工作計劃之一，成人宣誓日一直受到青少年及社會各界的廣泛­熟悉及認同；並屢獲: 澳門青年事務委員會公民意識獎; 國際青年商會亞洲太平洋區周年大會獲得青少年活動大獎; 及全年最傑出工作計劃大獎等等。" />
    <meta property="og:locale" content="zh_HK" />
    <meta property="og:locale:alternate" content="en_US" />

    <script src="./exif.js"></script>
    <script>
        (function (i, s, o, g, r, a, m) {
            i['GoogleAnalyticsObject'] = r;
            i[r] = i[r] || function () {
                (i[r].q = i[r].q || []).push(arguments)
            }, i[r].l = 1 * new Date();
            a = s.createElement(o),
                m = s.getElementsByTagName(o)[0];
            a.async = 1;
            a.src = g;
            m.parentNode.insertBefore(a, m)
        })(window, document, 'script', '//www.google-analytics.com/analytics.js', 'ga');

        ga('create', 'UA-66312005-1', 'auto');
        ga('send', 'pageview');
    </script>
    <style type="text/css">
        body {
            font-family: Segoe, "Segoe UI", "DejaVu Sans", "Trebuchet MS", Verdana, sans-serif;
            margin: 0;
            background: #EEC;
            text-align: center;
            position: relative;
            padding: 0;
        }
        
        a {
            color: inherit;
        }
        
        a:link {
            color: inherit;
            text-decoration: none;
        }
        
        #headDiv {
            text-align: center;
            background-color: #2DB;
            background: url(img/bg-01.png) no-repeat;
            height: 240px;
            width: 100%;
            color: #FFF;
            font-size: 70px;
            line-height: 100px;
            vertical-align: central;
            position: fixed;
            top: 0;
            left: 0;
            font-weight: bold;
            z-index: 9;
        }
        
        #contentBlankDiv {
            height: 360px;
        }
        
        .contentDiv {
            padding: 20px;
            margin: 0;
            display: inline-block;
            text-align: center;
        }
        
        #nextDiv {
            right: 0;
        }
        
        #previousDiv {
            left: 0;
        }
        
        .navDiv {
            height: 200px;
            top: 0;
            z-index: 99;
            color: #FFF;
            font-size: 50px;
            line-height: 100px;
            display: inline-block;
            position: fixed;
        }
        
        .navDesktopDiv {
            height: 100px;
            top: 0;
            z-index: 99;
            color: #FFF;
            font-size: 30px;
            line-height: 45px;
            display: inline-block;
            position: fixed;
        }
        
        div#container {
            padding: 30px;
            font-family: 'verdana', lucida;
        }
        
        input {
            background-color: #2DB;
            background: url(img/bg-01.png) no-repeat;
            padding: 10px 20px;
            width: 235px;
            color: #fff;
            font-size: 14px;
            line-height: 14px;
            height: 20px;
            vertical-align: central;
            zoom: 400%
        }
        
        #saveContentDiv {
            display: none;
        }
        
        #imgControlDiv {
            color: #FFF;
            display: inline-block;
            width: 1100px;
            font-size: 55px;
            vertical-align: central;
            line-height: 100px;
        }
        
        .imgControlButtonDiv {
            background-color: #2DB;
            background: url(img/bg-01.png) no-repeat;
            margin: 20px 0;
            display: table;
            width: 100%;
        }
        
        .imgControlButtonDiv img {
            filter: drop-shadow(5px 5px 1px #000);
        }
        
        #creditsDiv {
            background-color: #DDD;
            width: 100%
        }
        
        #webViewAlert {
            position: fixed;
            right: 0;
            top: 0;
            z-index: 999;
        }
        
        #imgInputContainerDiv {
            position: relative;
        }
        
        #beginViewDiv {
            position: absolute;
            bottom: -370px;
            left: 0;
            z-index: 9000;
        }
        
        #imageCanvas {
            border: 0;
            padding: 0;
            margin: 0;
        }
    </style>
    <script>
        //Preload resources
        function preload() {
            var tmpArray = [];
            for (var i = 0; i < arguments.length; i++) {
                tmpArray[i] = new Image;
                tmpArray[i].src = arguments[i];
                //Oh we don't care what it result, just load and get out!
            }
        }
        preload('img/overlay_1100x1100-01.png', 'img/bg-01.png', 'img/icons/begin-01.png');
    </script>
    <script type="text/javascript">
        function isMobile() {
            if (navigator.userAgent.match(/Android/i) || navigator.userAgent.match(/webOS/i) || navigator.userAgent.match(/iPhone/i) || navigator.userAgent.match(/iPad/i) || navigator.userAgent.match(/iPod/i) || navigator.userAgent.match(/BlackBerry/i) || navigator.userAgent.match(/Windows Phone/i)) {
                return true;
            } else {
                return false;
            }
        }

        function currentObject() {
            this.imageURL = "";
            this.imageWidth = 0;
            this.imageHeight = 0;
            this.imageScaleX = 1;
            this.imageScaleY = 1;
            this.shortEdge = 1100;
            this.productDataURL = "";
            this.orientation = 0;
        }
        var current = new currentObject();
        var canvas;
        var js = document.createElement("script");
        js.type = "text/javascript";
        if (!isMobile()) {
            js.src = "fabric.desktop.min.js"
        } else {
            js.src = "fabric.mobile.min.js"
        }
        document.getElementsByTagName('head')[0].appendChild(js);
        //Normal Functions
        // Workaround for vertically squashed images in iOS6 & iOS7
        // general idea is using canvas element instead of image

        // detect scale ratio for image
        function detectVerticalSquash(img) {
            var ih = img.height;
            var canvas = document.createElement('canvas');
            canvas.width = 1;
            canvas.height = ih;
            var ctx = canvas.getContext('2d');
            ctx.drawImage(img, 0, 0);
            var data = ctx.getImageData(0, 0, 1, ih).data;
            // search image edge pixel position in case it is squashed vertically.
            var sy = 0;
            var ey = ih;
            var py = ih;
            while (py > sy) {
                var alpha = data[(py - 1) * 4 + 3];
                if (alpha === 0) {
                    ey = py;
                } else {
                    sy = py;
                }
                py = (ey + sy) >> 1;
            }
            var ratio = (py / ih);
            return (ratio === 0) ? 1 : ratio;
        }


        // create canvas with correct representation to replace with image
        function generateCanvas(image) {
            var canvas = document.createElement('canvas');
            var context = canvas.getContext('2d');
            var vertSquashRatio = detectVerticalSquash(image);
            if (vertSquashRatio < 1) {
                canvas.width = image.width * vertSquashRatio;
                canvas.height = image.height * vertSquashRatio;
                context.drawImage(image, 0, 0,
                    image.width * vertSquashRatio, image.height);
            } else {
                canvas.width = image.width * vertSquashRatio;
                canvas.height = image.height * vertSquashRatio;
                context.drawImage(image, 0, 0,
                    image.width, image.height);
            }

            return (canvas);
        }

        function handleImage(e) {
            var URL = window.URL || window.webkitURL;
            var imgInput = document.getElementById("imgInput");
            current.imageURL = URL.createObjectURL(imgInput.files[0]);
            resetImage();
        }

        function resetImage(p, r, b) {
            toggleElement(document.getElementById('beginViewImg'), "none");
            var img = new Image();
            img.onload = function () {
                current.imageWidth = generateCanvas(img).width;
                current.imageHeight = generateCanvas(img).height;
                calcImgScale();
                var imgInstance;
                if (p === true) {
                    imgInstance = new fabric.Image(generateCanvas(img), {
                        scaleX: current.imageScaleY,
                        scaleY: current.imageScaleX,
                        borderColor: 'red',
                        cornerColor: 'blue'
                    });
                } else {
                    imgInstance = new fabric.Image(generateCanvas(img), {
                        scaleX: current.imageScaleX,
                        scaleY: current.imageScaleY,
                        borderColor: 'red',
                        cornerColor: 'blue'
                    });
                }
                if (r > 0) {
                    imgInstance.setAngle(r);
                }
                canvas.clear();
                if (b != true) {
                    EXIF.getData(this, function () {
                        var r, p;
                        switch (EXIF.getTag(this, "Orientation")) {
                        case 8:
                            p = true;
                            r = 270;
                            break;
                        case 3:
                            p = false;
                            r = 180;
                            break;
                        case 6:
                            p = true;
                            r = 90;
                            break;
                        default:
                            p = false;
                            r = 0;
                        }
                        current.orientation = r;
                        resetImage(p, r, true);
                    });
                }
                canvas.add(imgInstance).setActiveObject(imgInstance);
                var overlayPath = "img/overlay_1100x1100-01.png";
                if (!isMobile() && (typeof InstallTrigger == 'undefined')) {
                    overlayPath = "img/overlay_550x550-01.png";
                }
                canvas.setOverlayImage(overlayPath, canvas.renderAll.bind(canvas), {
                    top: 0,
                    left: 0
                });
            }
            if ((current.imageURL != "")) {
                img.src = current.imageURL;
            }
        }

        function flipImage(type) {
            if ((current.orientation == 270) || (current.orientation == 90)) {
                if (type == 'h') {
                    type = 'v';
                } else {
                    type = 'h';
                }
            }
            switch (type) {
            case 'h':
                canvas.getActiveObject().set('flipX', !canvas.getActiveObject().get('flipX'));
                canvas.renderAll();
                break;
            case 'v':
                canvas.getActiveObject().set('flipY', !canvas.getActiveObject().get('flipY'));
                canvas.renderAll();
                break;
            default:
                canvas.getActiveObject().set('flipX', !canvas.getActiveObject().get('flipX'));
                canvas.renderAll();

            }
        }

        function calcImgScale() {
            if (current.imageWidth < current.imageHeight) {
                current.imageScaleX = current.shortEdge / current.imageWidth;
                current.imageScaleY = current.shortEdge / current.imageWidth;
            } else {
                current.imageScaleX = current.shortEdge / current.imageHeight;
                current.imageScaleY = current.shortEdge / current.imageHeight;
            }
        }

        function saveImage() {
            current.productDataURL = canvas.toDataURL({
                format: 'jpeg',
                quality: 0.9
            });
            document.getElementById('saveContentDiv').style.display = "inline-block";
            document.getElementById('saveContentImgDiv').innerHTML = "<img src='" + current.productDataURL + "'/>";
            document.getElementById('editorContentDiv').style.display = "none";
            if (isMobile()) {
                var clickToSave = document.getElementById('clickToSave');
                clickToSave.href = current.productDataURL;
                clickToSave.onclick = "";
                clickToSave.target = "_blank";
            }

        }

        function toggleElement(e, value) {
            value = value || "";
            if (value == "") {
                if ((e.style.display == "none") || (e.style.display == "")) {
                    e.style.display = "block";
                } else {
                    e.style.display = "none";
                }
            } else {
                e.style.display = value;
            }
        }

        function clickToSaveImageFile(e) {
            this.href = current.productDataURL;
            this.download = "icon.jpg";
        }

        function onload() {
            var isIE = /*@cc_on!@*/ false || !!document.documentMode;
            if (isIE) {
                alert('本程式不支援Internet Explorer, 請使用Chrome或Firefox瀏覽器!\nInternet Explorer was no longer supported. Please consider swtiching to Chrome/Firefox!');
            }
            if (!isMobile()) {
                if (typeof InstallTrigger !== 'undefined') { //is Firefox
                    var nextDiv = document.getElementById('nextDiv');
                    var previousDiv = document.getElementById('previousDiv');

                    nextDiv.style.transform = 'scale(0.5)';
                    nextDiv.style.transformOrigin = 'top center';

                    previousDiv.style.transform = 'scale(0.5)';
                    previousDiv.style.transformOrigin = 'top center';

                    var headDiv = document.getElementById('headDiv');
                    headDiv.style.fontSize = (parseInt(window.getComputedStyle(headDiv).getPropertyValue('font-size')) / 2) + "px";
                    headDiv.style.lineHeight = (parseInt(window.getComputedStyle(headDiv).getPropertyValue('line-height')) / 2) + "px";
                    headDiv.style.height = (parseInt(window.getComputedStyle(headDiv).getPropertyValue('height')) / 2) + "px";

                    var firefoxContainerDiv = document.getElementById('firefoxContainerDiv');
                    firefoxContainerDiv.style.transform = 'scale(0.5)';
                    firefoxContainerDiv.style.transformOrigin = 'top center';

                    var imgInput = document.getElementById("imgInput");

                    imgInput.style.width = "1060px";
                    imgInput.style.height = "160px";
                    imgInput.style.fontSize = "50px";
                    
                    document.getElementById('clickToSave').addEventListener('click', clickToSaveImageFile, false);

                } else {
                    var headDiv = document.getElementById('headDiv');
                    var contentBlankDiv = document.getElementById('contentBlankDiv');
                    var imageCanvas = document.getElementById('imageCanvas');
                    var imgSaveLink = document.getElementById('imgSaveLink');
                    headDiv.style.fontSize = (parseInt(window.getComputedStyle(headDiv).getPropertyValue('font-size')) / 2) + "px";
                    headDiv.style.lineHeight = (parseInt(window.getComputedStyle(headDiv).getPropertyValue('line-height')) / 2) + "px";
                    headDiv.style.height = (parseInt(window.getComputedStyle(headDiv).getPropertyValue('height')) / 2) + "px";
                    contentBlankDiv.style.height = (parseInt(window.getComputedStyle(contentBlankDiv).getPropertyValue('height')) / 3) + "px";
                    document.getElementById('imgInput').style.zoom = "200%";
                    imageCanvas.width = imageCanvas.width / 2;
                    imageCanvas.height = imageCanvas.height / 2;
                    current.shortEdge = 550;
                    document.getElementById('nextDiv').className = "navDesktopDiv";
                    document.getElementById('previousDiv').className = "navDesktopDiv";
                    var clickToSave = document.getElementById('clickToSave');
                    clickToSave.style.fontSize = (parseInt(window.getComputedStyle(clickToSave).getPropertyValue('font-size')) / 2) + "px";
                    document.getElementById("imgControlDiv").style.zoom = "50%";
                    document.getElementById("creditsDiv").style.zoom = "50%";
                    document.getElementById('clickToSave').addEventListener('click', clickToSaveImageFile, false);
                    var beginViewImg = document.getElementById('beginViewImg');
                    var beginViewImgWidth = beginViewImg.width;
                    var beginViewImgHeight = beginViewImg.height; //Prevent some browser keep aspect ratio automatically
                    beginViewImg.width = beginViewImgWidth / 2;
                    beginViewImg.height = beginViewImgHeight / 2;
                    document.getElementById('beginViewDiv').style.bottom = "-" + beginViewImg.height + "px";
                    document.getElementById('beginViewDiv').style.left = "50px";
                }
            } else {
                var standalone = window.navigator.standalone,
                    userAgent = window.navigator.userAgent.toLowerCase(),
                    safari = /safari/.test(userAgent),
                    ios = /iphone|ipod|ipad/.test(userAgent);

                if (ios) {
                    if (!standalone && safari) {
                        //browser
                    } else if (standalone && !safari) {
                        //standalone
                    } else if (!standalone && !safari) {
                        toggleElement(document.getElementById('webViewAlertImg'));
                    }
                }
            }
            canvas = new fabric.Canvas('imageCanvas', {
                backgroundColor: 'rgb(200,200,200)'
            });


            toggleElement(document.getElementById('beginViewImg'));
            var imageLoader = document.getElementById('imgInput');
            imageLoader.addEventListener('change', handleImage, false);


            document.getElementById('nextDiv').style.display = "inline-block";
            document.getElementById('previousDiv').style.display = "none";


        }

        function clickNextDiv() {
            document.getElementById('nextDiv').style.display = "none";
            document.getElementById('previousDiv').style.display = "inline-block";
            saveImage();
        }

        function clickPreviousDiv() {
            document.getElementById('nextDiv').style.display = "inline-block";
            document.getElementById('previousDiv').style.display = "none";
            document.getElementById('editorContentDiv').style.display = "inline-block";
            document.getElementById('saveContentDiv').style.display = "none";
        }
    </script>
</head>

<body onLoad="onload();">
    <div style="display:none" for="wechat_icon"><img src="./img/fb_og/icon-01.png" alt="" />
    </div>
    <div id="webViewAlert"><img id="webViewAlertImg" src="img/ios_webapp/webViewAlert-01.png" onClick="toggleElement(event.target);" style="display: none;" />
    </div>
    <div id="headDiv" class='navDiv'>
        2015&nbsp;成人宣誓日
        <br/>頭像&nbsp;Icon&nbsp;大變身
    </div>
    <div id="nextDiv" class='navDiv'>
        <br/>
        <a href="#" onclick="clickNextDiv();">儲存&nbsp;&gt;&gt;&nbsp;</a>
    </div>
    <div id="previousDiv" class='navDiv'>
        <br/>
        <a href="#" onclick="clickPreviousDiv();">&nbsp;&lt;&lt;&nbsp;返回</a>
    </div>
    <div id='firefoxContainerDiv'>
        <div id="contentBlankDiv">&nbsp;</div>
        <div id="editorContentDiv" class="contentDiv">
            <div id="imgInputContainerDiv">
                <input type="file" id="imgInput" name="imgInput" />
                <div id="beginViewDiv">
                    <img id="beginViewImg" src="img/icons/begin-01.png" style="display: none;" onClick="toggleElement(event.target);" />
                </div>
            </div>
            <canvas id="imageCanvas" width="1100px" height="1100px" align="center" style="text-align:center;"></canvas>
            <div id="imgControlDiv">
                <div class="imgControlButtonDiv">
                    <a href="#" onclick="flipImage('h');"><img src="img/icons/hFlip-01.png" width="64px" height="64px" style="vertical-align:middle;" />&nbsp;水平翻轉&nbsp;Horizontal&nbsp;Flip</a>
                </div>
                <div class="imgControlButtonDiv">
                    <a href="#" onclick="flipImage('v');"><img src="img/icons/vFlip-01.png" width="64px" height="64px" style="vertical-align:middle;" />&nbsp;垂直翻轉&nbsp;Vertical&nbsp;Flip</a>
                </div>
                <div class="imgControlButtonDiv">
                    <a href="#" onclick="resetImage();"><img src="img/icons/reset-01.png" width="64px" height="64px" style="vertical-align:middle;" />&nbsp;重設&nbsp;Reset</a>
                </div>
            </div>
        </div>
        <p>
            <div id="saveContentDiv" class="contentDiv">
                <div id="saveContentImgDiv" class="contentDiv"></div>
                <br/>
                <a href="#" id="clickToSave" style="font-size:55px;border-bottom:1px dotted black;">點擊儲存頭像&nbsp;Icon&nbsp;!</a></div>
        </p>
        <br/>
        <br/>
        <br/>
        <br/>
        <br/>
        <div id="creditsDiv" class="contentDiv" style="font-size:60px;">
            <div style="display:inline-block; padding:0px 50px;">
                <a href="http://fb.com/panmac.acd" target="_blank"><img src="img/icons/fbBar-01.png" style="vertical-align:middle;" />
                </a>
            </div>
            <br/>
            <div style="display:inline-block; padding:0px 50px;">
                <a href="http://fb.com/panmac.acd" target="_blank"><img src="img/icons/facebook-01.png" style="vertical-align:middle;" />
                </a> <img src="img/icons/wechat-01.png" style="vertical-align:middle;" /> </div>
            <br/>
            <hr/>
            <div style="display:inline-block; padding:0px 50px;"> 主辦:
                <a href="http://fb.com/panmacjc" target="_blank"><img src="img/icons/jci_logo-01.png" style="vertical-align:middle;" />
                </a>
            </div>
            <div style="display:inline-block; padding:0px 50px;"> 技術提供:
                <a href="http://fb.com/Previousproduction" target="_blank"><img src="img/icons/previous_logo-01.png" style="vertical-align:middle;" />
                </a>
            </div>
            <br/><span style="font-size:30px;line-height:30px;">請使用Chrome/Safari瀏覽器以獲得最佳效果。<br/>瀏覽器支援:Chrome(Mac/Win,iOS,Android),Firefox(Mac/Win),Safari(Mac/iOS)</span>
        </div>
    </div>
</body>

</html>